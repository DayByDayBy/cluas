# Code Review: Cluas MCP (Second Pass)

**Date:** 2025-11-15

## a) High-Level Summary

This second review of the "Cluas" repository shows some evolution from the initial version, primarily with the introduction of a shared memory system. The project remains a Python-based, multi-agent framework for academic research, themed around corvids.

The core functionality is still centered on the `CorvusMCP` character, which searches academic databases. The most significant change is the replacement of the simple cache with an `AgentMemory` system. This new system is designed to create a shared context between agents by logging discovered items (papers) and allowing retrieval based on recency, tags, or title.

The overall structure is largely the same: `characters` for agents, `cluas_mcp` for core logic, a placeholder `gradio` UI, and `tests`. However, many of the previously identified issues, such as placeholder API clients, empty character files, and clutter in the source directory, persist.

## b) Detailed Component Description

### `CorvusMCP` and `AgentMemory`

The `CorvusMCP` character in `src/characters/corvus.py` has been updated to integrate with the new `AgentMemory` system.

-   **Memory Integration:** Instead of a simple query cache, `CorvusMCP` now interacts with `AgentMemory`. When `search_papers` finds a paper, it logs it as a memory item, tagging it with "academic_search" and noting that "Corvus" mentioned it. This creates a persistent, shared knowledge base.
-   **Contextual Results:** The `search_papers` function now has a `memory_days` parameter. When used, it appends recently mentioned items from the shared memory to the search results. This allows the character to provide contextually aware responses that include not just new findings but also recently discussed topics.
-   **`AgentMemory` Class:** Located in `src/cluas_mcp/common/memory.py`, this class provides a more sophisticated storage mechanism than the previous `CacheManager`. It stores items in a JSON file with structured data, including timestamps, snippets, DOIs, and tags. It supports various retrieval methods:
    -   `get_recent(days)`: Fetches items referenced within a specific timeframe.
    -   `get_by_tag(tag)`: Retrieves items with a given tag.
    -   `search_title(query)`: Performs a simple text search on titles.
    -   `prune_long_term()`: A utility to clean up very old memories.

### Persisting Issues

-   **Placeholder API Clients:** The `PubMedClient` and `SemanticScholarClient` in `src/cluas_mcp/common/api_clients.py` are still not implemented. This remains the biggest blocker to the `CorvusMCP`'s full functionality, as it can only search arXiv.
-   **Empty Modules:** The `magpie`, `raven`, and `crow` character files are still empty. The `gradio/app.py` file is also empty, so there is no user-facing interface. The `formatting.py` file is still empty, which means the `corvus.py` file is still broken.
-   **Cluttered Source Directory:** The `src/cluas_mcp` directory still contains scripts that appear to be for testing or experimentation (`abstract_filtered.py`, `testing_arxiv.py`, `blah.py`).
-   **Lack of Tests for New Functionality:** There are no new tests for the `AgentMemory` class or for the updated `CorvusMCP` that uses it. The existing test files are either empty or haven't been updated.

## c) Opinionated Breakdown and Future Development

### What's Good

-   **Shared Memory is a Strong Concept:** The introduction of `AgentMemory` is a significant conceptual improvement. It moves the system from a simple tool to a collaborative multi-agent system where agents can build on each other's findings. This is a much more interesting and powerful architecture.
-   **Improved `CorvusMCP` Logic:** The ability to include recent memories in search results is a smart feature that makes the agent more context-aware.

### Room for Improvement

The project is still in a conceptual phase, and the execution is lagging behind the ideas. The critical feedback from the previous review still applies:

1.  **Fix the Broken Code:** The `formatting.py` file needs to be implemented so that `corvus.py` can run. This is the most immediate and critical issue.
2.  **Implement the API Clients:** The `PubMedClient` and `SemanticScholarClient` must be implemented for the core feature to work as designed.
3.  **Write Tests for `AgentMemory`:** The new memory system is a critical component and should be thoroughly tested. Tests for adding, retrieving, and pruning items are essential.
4.  **Clean the `src` Directory:** The experimental scripts should be moved out of the main source directory to improve code hygiene.
5.  **Define Other Agent Roles:** The vision for the other agents (`Magpie`, `Raven`, `Crow`) should be translated into code. What do they do? How do they interact with the shared memory? For example:
    -   `Magpie` could search for trending topics on social media or news sites and add them to memory with a "trending" tag.
    -   `Raven` could be tasked with a specific, long-term monitoring goal, periodically updating a set of memory items.
6.  **Build the UI:** A simple Gradio interface would provide a much-needed way to interact with the agents and see the shared memory in action.

### Future Expectations

The introduction of `AgentMemory` sets a clear direction for the project. The focus should now be on building out the ecosystem around this shared memory. I expect the next phase of development to involve:

-   Making the existing `CorvusMCP` character fully functional by implementing the remaining API clients.
-   Adding at least one more character with a distinct role that reads from or writes to the `AgentMemory`.
-   Adding a basic user interface to demonstrate the multi-agent interaction.

The project has a stronger conceptual foundation now, but it needs a significant implementation effort to realize its potential. The priority should be to make the existing code runnable and tested before adding more features.
