# Code Review: Cluas MCP

**Date:** 2025-11-15

## a) High-Level Summary

This repository, "Cluas," contains a Python-based project that appears to be a multi-character or multi-agent system for academic research. The name "Cluas" and the character names (Corvus, Raven, Magpie, Crow) all relate to corvids, a family of intelligent birds, suggesting a theme of intelligence and information gathering.

The core functionality revolves around searching academic paper databases (arXiv, PubMed, Semantic Scholar) based on user queries. The system is designed with a fallback mechanism, starting with PubMed and progressing to other sources if no results are found. It includes a caching mechanism to speed up repeated searches.

The project is structured into several components:

-   `characters`: Different agents with specific functionalities. So far, only `CorvusMCP` is implemented.
-   `cluas_mcp`: The core logic, including API clients for academic search engines, caching, and data formatting.
-   `gradio`: Suggests a web interface for interacting with the system, though it is currently empty.
-   `tests`: Unit tests for the `CorvusMCP` character, indicating a commitment to testing.

## b) Detailed Component Description

### `CorvusMCP` Character

The `CorvusMCP` class in `src/characters/corvus.py` is the most developed part of the application. Its primary role is to search for academic papers.

-   **Search Priority:** It follows a clear search strategy: PubMed -> Semantic Scholar -> arXiv. This is a sensible approach, as PubMed is a high-quality, curated database for biomedical literature.
-   **Caching:** It uses a `CacheManager` to store search results. When a search is requested, it first checks the cache for the given query. If found, it returns the cached results, avoiding redundant API calls. If not, it performs the search, and the new results are cached for future use.
-   **API Clients:** It utilizes `PubMedClient`, `SemanticScholarClient`, and `ArxivClient` from `src/cluas_mcp/common/api_clients.py`. Currently, only the `ArxivClient` has a concrete implementation; the others are placeholders.
-   **Data Formatting:** After fetching results, it cleans and formats them into a consistent structure, including title, abstract, authors, publication date, DOI, and a link.

### API Clients and Caching

-   **`api_clients.py`**: This file defines classes for interacting with external academic APIs. The `ArxivClient` is functional and constructs a search query that combines the user's query with a predefined list of keywords related to corvids. This suggests the system has a specialized focus.
-   **`cache.py`**: The `CacheManager` provides a simple file-based JSON cache. It reads and writes to a `cache.json` file, which is effective for a small-scale application.

### Testing

The `tests/test_corvus.py` file contains unit tests for the `CorvusMCP` class. The tests use `unittest.mock` to patch the API clients and cache manager, allowing for isolated testing of the character's logic. The tests cover several scenarios:

-   Cache hits.
-   Successful searches with PubMed.
-   Fallback to Semantic Scholar when PubMed returns no results.
-   Fallback to arXiv when both PubMed and Semantic Scholar fail.

This demonstrates good software development practices.

## c) Opinionated Breakdown and Future Development

### What's Good

-   **Clear Structure:** The project is well-organized, with a logical separation of concerns (characters, core logic, web interface, tests).
-   **Intelligent Design:** The fallback search strategy and caching mechanism are well-thought-out features that improve both the quality of results and the performance of the system.
-   **Thematic Cohesion:** The corvid theme is creative and consistently applied, which can help in building a strong identity for the project.
-   **Test Coverage:** The presence of unit tests for the main character is a great sign of a healthy codebase.

### Suggestions for Improvement

-   **Implement Placeholder Clients:** The `PubMedClient` and `SemanticScholarClient` are currently placeholders. Implementing these would be the highest priority next step to make `CorvusMCP` fully functional.
-   **Expand Character Roles:** The other characters (`Raven`, `Magpie`, `Crow`) are currently empty files. Their roles should be defined and implemented. Based on the `blah.py` file, it seems the intention is for them to have distinct functions:
    -   `magpie.find_trending("topic")`: Could focus on identifying popular or recent papers.
    -   `raven.get_environmental_data("location")`: Could specialize in a different type of data, perhaps from different sources.
    -   `crow.analyze_patterns("dataset")`: Might be geared towards data analysis or trend detection within a set of papers.
-   **Develop the Gradio UI:** The `gradio/app.py` is empty. Building a simple web interface would make the system much more accessible and usable.
-   **Refine the `ArxivClient`:** The `ArxivClient` currently combines the user's query with a hardcoded list of corvid-related keywords. This should be made more flexible, perhaps by allowing the character or user to specify the topic or domain of interest. The `search_academic_papers` function in `tools.py` seems to be a step in this direction.
-   **Configuration Management:** API keys or other configuration settings should not be hardcoded. A configuration file or environment variables should be used.
-   **Error Handling:** The API clients should have more robust error handling for network issues or unexpected API responses.

### Future Expectations

I expect the project to continue developing by fleshing out the existing structure. The immediate next steps would be to implement the remaining API clients and then define the unique functionalities of the other characters. Once the core logic is more complete, the focus will likely shift to building the Gradio web interface to allow users to interact with the different characters.

Overall, this is a promising project with a solid foundation and a clear, creative vision. The code is clean, well-structured, and demonstrates good engineering practices.
